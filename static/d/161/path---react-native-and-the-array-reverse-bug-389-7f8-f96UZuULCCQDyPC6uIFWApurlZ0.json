{"data":{"site":{"siteMetadata":{"title":"Christian Brevik","author":"Christian Brevik"}},"markdownRemark":{"id":"6b0b516b-1297-5158-8c06-d2f66b8431ed","excerpt":"The news that broke a couple of days ago about the  -bug that occurs in the newly released iOS 12 was  a bit  scary. I first learnt about it…","html":"<p>The news that broke a couple of days ago about the <code class=\"language-text\">Array.reverse</code>-bug that occurs in the newly released iOS 12 was <em>a bit</em> scary. I first learnt about it from <a href=\"https://stackoverflow.com/questions/52390368/array-state-will-be-cached-in-ios-12-safari-is-it-a-bug-or-feature/\">this Stack Overflow-post</a> by way of <a href=\"https://news.ycombinator.com/item?id=18021835\">Hacker News</a>.</p>\n<p>Developers have experienced a JavaScript-bug in Safari iOS 12, where an <code class=\"language-text\">Array.reverse</code> will cache the <code class=\"language-text\">Array</code> value state, which will still remain reversed even if you reload the page. I think most developers will understand why that is a problem. And apparently the same error exists on macOS as well, not just iOS.</p>\n<p>After researching it a bit more, I found that it’s a bit misleading to call it a “Safari bug” though, because the <a href=\"https://bugs.webkit.org/show_bug.cgi?id=188794\">WebKit bug report</a> suggests that it actually exists in the <code class=\"language-text\">JavaScriptCore</code>-framework. Having contributed a bit to the React Native (RN) framework, I quickly noticed that this might be trouble. Because the RN JavaScript-bundle actually runs inside the <code class=\"language-text\">JavaScriptCore</code>-framework on iOS!</p>\n<p>I am currently working at <a href=\"https://www.ice.no/\">Ice</a> (the Norwegian mobile operator) on their app, which is made with RN, and knew I had to look into this right away.</p>\n<p><strong>What I found is that everyone who upgrades to iOS 12 on their device, will experience this bug with React Native-apps they have installed.</strong></p>\n<p>So RN-developers should start getting a <strong>little</strong> worried.</p>\n<h1>Demonstrating the bug</h1>\n<p>I have made an <a href=\"https://github.com/cbrevik/arrayReverseBug\">example app</a> to demonstrate that this bug will occur in RN-apps as well:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7d5127cb50fb58391efab9a20fb33db2/a8524/red-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 375px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 177.86666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAkCAYAAACJ8xqgAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB+0lEQVRIx+1VXXOiMBTl//+h/Qd92XFr6xcVRVFcHBWhhQSklLP3BkIBnU6n7cy+8HAmycnl3I8kF8M9+lhu/2Kx2cF2PaQA4tdCQb4BYXLBfL3B6MkiGxdJ8b7PEHm5/uXdYbi3YERZTh9liLK3lkEJQNCobZ7T187+u/05SxFeMhhMcCQ86s1bc23T5JprWcFoeutG2I2myXVHDaPp7SfQC/aCXxX86CJ/Bs1LbnSfET9+WZRPrQatk4rj5sFIKq77HFsR8geH5xinSOAsUvhxgkCmtJY4vQgExDneAdyhPD+Edw5VU7kZIRPsebXb42FqYjgx8Wc8xdSyMRhN8PthhMHjGEPaM21HtbKnlYPokl8LNuvwQgYMHbWOgBHKi+K4jQU05zHutL1akNPlNNmr5bgwl2s156Y7XdiYEbjJzpYrFeWjOcf9ZFbX9SpCLbo7nlVtFF9551Gn5scSNnX4+XqrHI7nC2z2x1q0JcikioYMJRtwUy0q8GkTF1Carh9gbC0xoBpzLfmA9K+hfQ85bTrl4+EEQScsKBoFOmFB5YiJk7RO+XcQRjhRJvoKXd9DFuUoRIJ0u4Mkz5J+XJJqWM4JlKpcbSBoP3G2SOhGxEVZmqtDibVoXqZao6hwa51/9FIaop9FHYTmvivY+iYv+gbbC/aC/0/wHzwa+XtkyElEAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"The Array.reverse bug inside a React Native-app\"\n        title=\"\"\n        src=\"/static/7d5127cb50fb58391efab9a20fb33db2/a8524/red-1.png\"\n        srcset=\"/static/7d5127cb50fb58391efab9a20fb33db2/bfbd1/red-1.png 148w,\n/static/7d5127cb50fb58391efab9a20fb33db2/f2961/red-1.png 295w,\n/static/7d5127cb50fb58391efab9a20fb33db2/a8524/red-1.png 375w\"\n        sizes=\"(max-width: 375px) 100vw, 375px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>It is important to note here that if you have the RN remote debugger attached, this bug will not occur. This is because the remote debugger runs the JS-bundle inside of the Chrome-debugger.</p>\n<p>Now your gut reaction may be to run to your codebases and search for “Array.reverse”, and manually fix it in all those locations. But remember that any dependencies you use will also experience the same bug. This might lead to some really subtle bugs that will be difficult to debug.</p>\n<h1>Fixing the bug</h1>\n<p>Of course, this being the JavaScript-community, someone has already released a <a href=\"https://www.npmjs.com/package/array-reverse-polyfill\">polyfill for this bug</a>. You can install this package with:</p>\n<p><code class=\"language-text\">yarn add array-reverse-polyfill</code></p>\n<p>And then include it up top in your root <code class=\"language-text\">index.js</code> file:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">import &quot;array-reverse-polyfill&quot;;\nimport { AppRegistry } from &quot;react-native&quot;;\nimport App from &quot;./App&quot;;\nimport { name as appName } from &quot;./app.json&quot;;\n\nAppRegistry.registerComponent(appName, () =&gt; App);</code></pre></div>\n<p>This will override the <code class=\"language-text\">Array.prototype.reverse</code> with a fixed version, if the original version is found to be buggy:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/832dde755734838254325f18cde40bef/a8524/fixed.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 375px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 177.86666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAkCAYAAACJ8xqgAAAACXBIWXMAAAsTAAALEwEAmpwYAAACCUlEQVRIx+1VyXKjMBDl/39o/mAuqUw5seMVTDDYeGERXpAA22+6FUNhJTOTmhxy4fBK3S3x1C3RT1awi+H4K9iLJeZBCAXgWF01TmcgUxVGjov+ZIbFJoK8oplrjz/Cn+itZ7AO5RlCljiUl7sFbXtfnDXxgUaTqB6TUkEUJSwO5BfoifYi0/5TrPbzG6w6GzMr0zZj5ljDMjP4KjrCjvB/Cf/2I38G7Z/cMtuImz+/vrVjA/LlLcbiwZC3mNmOdxnyB9vsiOhwQnJSiI8Saa7IzxHtT0gp5oVbsEKFsUCYCC0qH2bIAd7ZXa7xNByj9zLGr8EQw9kcj/0XPDz18fg8QI/mxnOP5C7AxPXeKZBlNjlLFaPOus6AIfJCx1jKUrJ5PBqy1xByuVwm7zrzAoydV22z6A7tOUYEFlkWW87yeTylKkbNub7LsCYNdok+G44fqkuT5f5WWnzMtcJPPV9v2J/Y8NZbyBup1b6hgoIj28WEzki1blpe3sSTY5mssIpSDIiIz9mlCtbJvnkamgwTRTdaKISZgB9H2o9lTpAaqSoQsa9yZFWp161ECkG2KMvmrJtbfhUbOMkSHo1zEWrbTgK46RrTaEHwKUaPWRxgFvt6zss2mOw8OPFSvyen+glovwl3aJXLa2TLb6+p36S7kv/ZXhU+1YLWV3r4Q8JOYDvCjvA7CH8D6BD3UgRGkf8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"fixed\"\n        title=\"\"\n        src=\"/static/832dde755734838254325f18cde40bef/a8524/fixed.png\"\n        srcset=\"/static/832dde755734838254325f18cde40bef/bfbd1/fixed.png 148w,\n/static/832dde755734838254325f18cde40bef/f2961/fixed.png 295w,\n/static/832dde755734838254325f18cde40bef/a8524/fixed.png 375w\"\n        sizes=\"(max-width: 375px) 100vw, 375px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>If you only want to apply this fix for devices running iOS 12, you could do something like this instead:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">import { Platform } from &quot;react-native&quot;;\nif (Platform.Version === &quot;12.0&quot;) {\n  require(&quot;array-reverse-polyfill&quot;);\n}</code></pre></div>\n<p>It’s important to say that I have not published any apps with this fix to the AppStore, and you should carefully test your apps if you want to apply this fix.</p>\n<h1>Outro</h1>\n<p>On a personal note, I think “just” applying fixes like this is going down the wrong road. If we have to manually polyfill for every little bug, then we’re reverting back to practices which were not productive to begin with. I believe it is a good idea to encourage people to upgrade to a version of iOS that fixes the problem, since it is a global bug which can affect many other apps.</p>\n<p>But of course, if this bug causes major problems in your app, a quick fix is better than nothing.</p>\n<p>It is important to note that this will also occur in other frameworks or apps using <code class=\"language-text\">JavaScriptCore</code>, which includes Chrome on iOS, and <code class=\"language-text\">WebViews</code> which native apps are displaying, etc.</p>\n<p><a href=\"https://github.com/cbrevik/arrayReverseBug\">Check out the example code here</a> if you want to test for yourself.</p>\n<p><strong>Note:</strong> This was orginally <a href=\"https://blog.novanet.no/react-native-and-the-array-reverse-bug/\">posted on the Novanet blog</a>. Check out that blog for more .NET- and RN-related content.</p>","frontmatter":{"title":"React Native and the Array.reverse bug","date":"September 21, 2018"}}},"pageContext":{"slug":"/react-native-and-the-array-reverse-bug/","previous":{"fields":{"slug":"/your-first-vs-code-extension/"},"frontmatter":{"title":"Your first VS Code extension"}},"next":null}}